# Generated by Django 5.2.10 on 2026-01-21 01:06

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('organizations', '0005_add_base_model_fields'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='IntegrationConfig',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_comment='Soft delete flag, records are filtered out by default', db_index=True, default=False, verbose_name='Is Deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_comment='Timestamp when record was soft deleted', null=True, verbose_name='Deleted At')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_comment='Timestamp when record was created', verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, db_comment='Timestamp when record was last updated', verbose_name='Updated At')),
                ('custom_fields', models.JSONField(blank=True, db_comment='Dynamic fields for metadata-driven extensions', default=dict, verbose_name='Custom Fields')),
                ('system_type', models.CharField(choices=[('m18', '万达宝M18'), ('sap', 'SAP'), ('kingdee', '金蝶'), ('yonyou', '用友'), ('oracle', 'Oracle EBS'), ('odoo', 'Odoo')], help_text='External ERP system type', max_length=20, verbose_name='System Type')),
                ('system_name', models.CharField(help_text='Custom name, e.g., "Production M18"', max_length=100, verbose_name='System Name')),
                ('connection_config', models.JSONField(default=dict, help_text='API endpoint, auth info, etc. Structure defined by adapters', verbose_name='Connection Config')),
                ('enabled_modules', models.JSONField(default=list, help_text='Enabled integration modules, e.g., ["procurement", "finance"]', verbose_name='Enabled Modules')),
                ('sync_config', models.JSONField(default=dict, help_text='Sync interval, auto-sync settings', verbose_name='Sync Config')),
                ('mapping_config', models.JSONField(default=dict, help_text='Field mapping configuration', verbose_name='Mapping Config')),
                ('is_enabled', models.BooleanField(db_index=True, default=True, verbose_name='Is Enabled')),
                ('last_sync_at', models.DateTimeField(blank=True, null=True, verbose_name='Last Sync At')),
                ('last_sync_status', models.CharField(choices=[('pending', '待执行'), ('running', '执行中'), ('success', '成功'), ('partial_success', '部分成功'), ('failed', '失败'), ('cancelled', '已取消')], default='pending', max_length=20, verbose_name='Last Sync Status')),
                ('health_status', models.CharField(choices=[('healthy', '健康'), ('degraded', '降级'), ('unhealthy', '不可用')], db_index=True, default='unhealthy', max_length=20, verbose_name='Health Status')),
                ('last_health_check_at', models.DateTimeField(blank=True, null=True, verbose_name='Last Health Check At')),
                ('created_by', models.ForeignKey(blank=True, db_comment='User who created this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Created By')),
                ('deleted_by', models.ForeignKey(blank=True, db_comment='User who soft deleted this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_deleted', to=settings.AUTH_USER_MODEL, verbose_name='Deleted By')),
                ('organization', models.ForeignKey(blank=True, db_comment='Organization for multi-tenant data isolation', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='organizations.organization', verbose_name='Organization')),
                ('updated_by', models.ForeignKey(blank=True, db_comment='User who last updated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='Updated By')),
            ],
            options={
                'verbose_name': 'Integration Config',
                'verbose_name_plural': 'Integration Configs',
                'db_table': 'integration_config',
                'ordering': ['-created_at'],
                'unique_together': {('organization', 'system_type')},
            },
        ),
        migrations.CreateModel(
            name='IntegrationSyncTask',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_comment='Soft delete flag, records are filtered out by default', db_index=True, default=False, verbose_name='Is Deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_comment='Timestamp when record was soft deleted', null=True, verbose_name='Deleted At')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_comment='Timestamp when record was created', verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, db_comment='Timestamp when record was last updated', verbose_name='Updated At')),
                ('custom_fields', models.JSONField(blank=True, db_comment='Dynamic fields for metadata-driven extensions', default=dict, verbose_name='Custom Fields')),
                ('task_id', models.CharField(help_text='Globally unique task identifier', max_length=100, unique=True, verbose_name='Task ID')),
                ('module_type', models.CharField(choices=[('procurement', '采购管理'), ('finance', '财务核算'), ('inventory', '库存管理'), ('hr', '人力资源'), ('crm', '客户关系')], max_length=20, verbose_name='Module Type')),
                ('direction', models.CharField(choices=[('pull', '拉取(第三方→本系统)'), ('push', '推送(本系统→第三方)'), ('bidirectional', '双向同步')], max_length=20, verbose_name='Sync Direction')),
                ('business_type', models.CharField(help_text='e.g., purchase_order, voucher', max_length=50, verbose_name='Business Type')),
                ('sync_params', models.JSONField(default=dict, help_text='Execution parameters for this sync', verbose_name='Sync Params')),
                ('status', models.CharField(choices=[('pending', '待执行'), ('running', '执行中'), ('success', '成功'), ('partial_success', '部分成功'), ('failed', '失败'), ('cancelled', '已取消')], db_index=True, default='pending', max_length=20, verbose_name='Status')),
                ('total_count', models.IntegerField(default=0, verbose_name='Total Count')),
                ('success_count', models.IntegerField(default=0, verbose_name='Success Count')),
                ('failed_count', models.IntegerField(default=0, verbose_name='Failed Count')),
                ('error_summary', models.JSONField(default=list, help_text='Detailed failure information', verbose_name='Error Summary')),
                ('started_at', models.DateTimeField(blank=True, db_index=True, null=True, verbose_name='Started At')),
                ('completed_at', models.DateTimeField(blank=True, db_index=True, null=True, verbose_name='Completed At')),
                ('duration_ms', models.IntegerField(blank=True, null=True, verbose_name='Duration (ms)')),
                ('celery_task_id', models.CharField(blank=True, help_text='Associated Celery async task ID', max_length=100, verbose_name='Celery Task ID')),
                ('config', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sync_tasks', to='integration.integrationconfig', verbose_name='Integration Config')),
                ('created_by', models.ForeignKey(blank=True, db_comment='User who created this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Created By')),
                ('deleted_by', models.ForeignKey(blank=True, db_comment='User who soft deleted this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_deleted', to=settings.AUTH_USER_MODEL, verbose_name='Deleted By')),
                ('organization', models.ForeignKey(blank=True, db_comment='Organization for multi-tenant data isolation', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='organizations.organization', verbose_name='Organization')),
                ('updated_by', models.ForeignKey(blank=True, db_comment='User who last updated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='Updated By')),
            ],
            options={
                'verbose_name': 'Integration Sync Task',
                'verbose_name_plural': 'Integration Sync Tasks',
                'db_table': 'integration_sync_task',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DataMappingTemplate',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_comment='Soft delete flag, records are filtered out by default', db_index=True, default=False, verbose_name='Is Deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_comment='Timestamp when record was soft deleted', null=True, verbose_name='Deleted At')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_comment='Timestamp when record was created', verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, db_comment='Timestamp when record was last updated', verbose_name='Updated At')),
                ('custom_fields', models.JSONField(blank=True, db_comment='Dynamic fields for metadata-driven extensions', default=dict, verbose_name='Custom Fields')),
                ('system_type', models.CharField(choices=[('m18', '万达宝M18'), ('sap', 'SAP'), ('kingdee', '金蝶'), ('yonyou', '用友'), ('oracle', 'Oracle EBS'), ('odoo', 'Odoo')], max_length=20, verbose_name='System Type')),
                ('business_type', models.CharField(help_text='e.g., purchase_order, asset, voucher', max_length=50, verbose_name='Business Type')),
                ('template_name', models.CharField(max_length=100, verbose_name='Template Name')),
                ('field_mappings', models.JSONField(default=dict, help_text='Format: {"local_field": "external_field", ...}', verbose_name='Field Mappings')),
                ('value_mappings', models.JSONField(default=dict, help_text='Format: {"field_name": {"local_value": "external_value"}}', verbose_name='Value Mappings')),
                ('transform_rules', models.JSONField(default=list, help_text='Data transformation rule list', verbose_name='Transform Rules')),
                ('is_active', models.BooleanField(default=True, verbose_name='Is Active')),
                ('created_by', models.ForeignKey(blank=True, db_comment='User who created this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Created By')),
                ('deleted_by', models.ForeignKey(blank=True, db_comment='User who soft deleted this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_deleted', to=settings.AUTH_USER_MODEL, verbose_name='Deleted By')),
                ('organization', models.ForeignKey(blank=True, db_comment='Organization for multi-tenant data isolation', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='organizations.organization', verbose_name='Organization')),
                ('updated_by', models.ForeignKey(blank=True, db_comment='User who last updated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='Updated By')),
            ],
            options={
                'verbose_name': 'Data Mapping Template',
                'verbose_name_plural': 'Data Mapping Templates',
                'db_table': 'data_mapping_template',
                'unique_together': {('organization', 'system_type', 'business_type')},
            },
        ),
        migrations.CreateModel(
            name='IntegrationLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_comment='Soft delete flag, records are filtered out by default', db_index=True, default=False, verbose_name='Is Deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_comment='Timestamp when record was soft deleted', null=True, verbose_name='Deleted At')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_comment='Timestamp when record was created', verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, db_comment='Timestamp when record was last updated', verbose_name='Updated At')),
                ('custom_fields', models.JSONField(blank=True, db_comment='Dynamic fields for metadata-driven extensions', default=dict, verbose_name='Custom Fields')),
                ('system_type', models.CharField(choices=[('m18', '万达宝M18'), ('sap', 'SAP'), ('kingdee', '金蝶'), ('yonyou', '用友'), ('oracle', 'Oracle EBS'), ('odoo', 'Odoo')], max_length=20, verbose_name='System Type')),
                ('integration_type', models.CharField(help_text='e.g., m18_po, sap_fi', max_length=50, verbose_name='Integration Type')),
                ('action', models.CharField(choices=[('pull', '拉取(第三方→本系统)'), ('push', '推送(本系统→第三方)'), ('bidirectional', '双向同步')], max_length=20, verbose_name='Action')),
                ('request_method', models.CharField(help_text='GET, POST, PUT, DELETE, etc.', max_length=10, verbose_name='Request Method')),
                ('request_url', models.TextField(verbose_name='Request URL')),
                ('request_headers', models.JSONField(default=dict, verbose_name='Request Headers')),
                ('request_body', models.JSONField(default=dict, verbose_name='Request Body')),
                ('status_code', models.IntegerField(blank=True, null=True, verbose_name='HTTP Status Code')),
                ('response_body', models.JSONField(default=dict, verbose_name='Response Body')),
                ('response_headers', models.JSONField(default=dict, verbose_name='Response Headers')),
                ('success', models.BooleanField(db_index=True, default=False, verbose_name='Success')),
                ('error_message', models.TextField(blank=True, verbose_name='Error Message')),
                ('duration_ms', models.IntegerField(blank=True, null=True, verbose_name='Duration (ms)')),
                ('business_type', models.CharField(blank=True, max_length=50, verbose_name='Business Type')),
                ('business_id', models.CharField(blank=True, max_length=100, verbose_name='Business ID')),
                ('external_id', models.CharField(blank=True, max_length=100, verbose_name='External System ID')),
                ('created_by', models.ForeignKey(blank=True, db_comment='User who created this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Created By')),
                ('deleted_by', models.ForeignKey(blank=True, db_comment='User who soft deleted this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_deleted', to=settings.AUTH_USER_MODEL, verbose_name='Deleted By')),
                ('organization', models.ForeignKey(blank=True, db_comment='Organization for multi-tenant data isolation', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='organizations.organization', verbose_name='Organization')),
                ('updated_by', models.ForeignKey(blank=True, db_comment='User who last updated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='Updated By')),
                ('sync_task', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='logs', to='integration.integrationsynctask', verbose_name='Sync Task')),
            ],
            options={
                'verbose_name': 'Integration Log',
                'verbose_name_plural': 'Integration Logs',
                'db_table': 'integration_log',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['organization', 'system_type'], name='integration_organiz_6a2f05_idx'), models.Index(fields=['created_at'], name='integration_created_feea94_idx'), models.Index(fields=['success'], name='integration_success_d9f990_idx'), models.Index(fields=['-created_at'], name='integration_created_e48687_idx')],
            },
        ),
    ]
